{% extends 'vehicleLayout.html' %}
{% load static %}

{% block content %}
<div class="main-wrapper py-5">

    <!-- Header / Navbar -->
    <header class="mb-5">
        <nav class="d-flex justify-content-between align-items-center px-4 py-3 rounded-pill bg-white shadow-sm">
            <div>
                <strong class="fs-4">CarPal</strong>
            </div>
            <div>
                <a href="http://127.0.0.1:8000/" class="text-decoration-none fw-bold">Home</a>
            </div>
        </nav>
    </header>
    <!-- Vehicle Selection Section -->
    <main class="text-center">
        <div class="d-flex justify-content-center flex-wrap gap-3 mb-4">

            <!-- Year Dropdown -->
            <div class="dropdown">
                <button class="btn dropdown-toggle rounded-pill px-4 py-2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Year
                </button>
                <ul class="dropdown-menu">
                    {% for year in years %}
                        <li><a class="dropdown-item" href="#">{{ year }}</a></li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Make Dropdown -->
            <div class="dropdown">
                <button class="btn dropdown-toggle rounded-pill px-4 py-2" type="button" id="makeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Make
                </button>
                <ul class="dropdown-menu" aria-labelledby="makeDropdown" id="makeOptions">
                    {% for make in makes %}
                    <li><a class="dropdown-item" href="#" data-make-id="{{ make.id }}">{{ make.name }}</a></li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Model Dropdown -->
            <div class="dropdown">
                <button class="btn dropdown-toggle rounded-pill px-4 py-2" type="button" id="modelDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Model
                </button>
                <ul class="dropdown-menu" aria-labelledby="modelDropdown" id="modelOptions">
                </ul>
            </div>
        </div>

        <!-- VIN Input -->
        <div class="mb-4">
            <p class="fw-bold">OR:</p>
            <p class="fw-bold">enter your VIN:</p>
            <input type="text" class="form-control w-50 mx-auto" placeholder="VIN Number">
        </div>

        <!-- Search Button -->
        <a href="{% url 'repairOptions' %}" class="search-button">Search</a>
        <a href="{% url 'repairOptions' %}" class="search-button">Add a Vehicle</a>
    </main>
    <div>

    <!-- Footer -->
    <footer class="mt-5 text-center text-muted small">
        <p class="mb-0">&copy; 2025 CarPal | University of Nebraskaâ€“Omaha</p>
    </footer>


<!-- Page-specific Scripts -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const makeOptions = document.getElementById('makeOptions');
    const modelOptions = document.getElementById('modelOptions');
    const modelDropdownButton = document.getElementById('modelDropdown');
    const makeDropdownButton = document.getElementById('makeDropdown');

    makeOptions.addEventListener('click', function (event) {
        if (event.target.matches('.dropdown-item')) {
            event.preventDefault();
            const makeId = event.target.getAttribute('data-make-id');
            const makeName = event.target.textContent;

            // Update make button text
            makeDropdownButton.textContent = makeName;

            // Clear old model options
            modelOptions.innerHTML = '<li><a class="dropdown-item" href="#">Loading...</a></li>';

            // Fetch new models
            fetch(`/vehicles/get-models/?make_id=${makeId}`)
                .then(response => response.json())
                .then(data => {
                    modelOptions.innerHTML = ''; // Clear loading text
                    if (data.length === 0) {
                        modelOptions.innerHTML = '<li><a class="dropdown-item disabled" href="#">No models found</a></li>';
                    } else {
                        data.forEach(model => {
                            const li = document.createElement('li');
                            const a = document.createElement('a');
                            a.classList.add('dropdown-item');
                            a.href = '#';
                            a.textContent = model.name;
                            a.setAttribute('data-model-id', model.id);
                            li.appendChild(a);
                            modelOptions.appendChild(li);
                        });
                    }
                    modelDropdownButton.textContent = 'Select Model';
                })
                .catch(err => {
                    console.error('Fetch error:', err);
                    modelOptions.innerHTML = '<li><a class="dropdown-item disabled" href="#">Error loading models</a></li>';
                });
        }
    });

    modelOptions.addEventListener('click', function (event) {
        if (event.target.matches('.dropdown-item') && !event.target.classList.contains('disabled')) {
            event.preventDefault();
            const modelName = event.target.textContent;
            modelDropdownButton.textContent = modelName;
        }
    });
});
</script>

{% endblock %}

